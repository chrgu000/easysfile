

[TOC]



# 一 api 参数说明



## 1 api例子参考

传参方式：    get 

传参例子：

http://www.gzfesco.cn/api/qcshcz/ballgame/step1/?sex=1

非传参例子：

http://www.gzfesco.cn/api/qcshcz/ballgame/step1/（因为本次项目有用到微信，为防止授权时候浏览器地址会跳回redirect_url？code=xxxxx，**所以此处地址末尾要最好加/**，否则如果是用到微信授权功能，会失败。）



## 2 返回json格式

{"code":20000,"message":"通讯正常","data":[]}

| 参数    | 参数类型 | 参数说明                         |
| ------- | -------- | -------------------------------- |
| code    | int      | 20000代表成功通讯，40000代表失败 |
| message | string   | 消息体                           |
| data    | array    | 返回的实际数据                   |



## 3 代码code说明

| 代码(code) | 说明                |
| ---------- | ------------------- |
| 20000      | 通讯成功            |
| 40000      | 通讯失败            |
| 40001      | url中不能含有<>字符 |
| 40002      | 没找到对应的类文件  |
| 40003      | 没找到对应的方法    |



## 4 项目id说明（pid）

| 项目名称     | pid  |
| ------------ | ---- |
| 车家互动     | 2    |
| EV艺术       | 3    |
| 大屏篮球互动 | 4    |
| 智能驾驶仓   | 6    |



# 二 本次上海车展实际接口说明

## 0 通用接口

#### 1 询问游戏状态接口（谁在玩）

请求 ：http://www.gzfesco.cn/api/qcshcz/noweixin/getstate/?id=3

| 参数 | 取值范围 | 说明                             |
| ---- | -------- | -------------------------------- |
| id   | 2，3     | 项目id，2为车家互动，3为ev艺术灯 |

正常返回示例：

{"code":20002,"message":"state=1","data":[{"nickname":"","eid":"1"}]}

| 参数     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| eid      | 仅仅当游戏开启状态code=20002的时候，才返回用户id，及昵称     |
| nickname | 仅仅当游戏开启状态code=20002的时候，才返回用户id，及昵称     |
| code     | =20001时候，在date中返回state=0；=20002时候，返回玩家id和昵称，=40007的时候为严重异常，通过异常通知接口告诉我 |

失败返回示例：

{"code":40000,"message":"\u901a\u8baf\u6210\u529f"}

表示通讯正常，但存有异常状况

## 1 EV艺术（灯）

#### 1 通知服务器游戏结束接口

请求 ：http://www.gzfesco.cn/api/qcshcz/evart/zero/?pid=3&finish=1

| 参数   | 取值范围 | 说明                                        |
| ------ | -------- | ------------------------------------------- |
| pid    | 3        | 项目id                                      |
| finish | 0,1      | 0代表未完成，1代表已完成项目体验            |
| code   |          | 为40008,40009的时候，通过异常通知接口告诉我 |

正常返回示例：

{"code":20003,"message":"game state now set to 0"}

失败返回示例：

{"code":40000,"message":"\u901a\u8baf\u6210\u529f"}

表示通讯正常，但存有异常状况

#### 2 用户扫码注册玩耍接口

 http://www.gzfesco.cn/api/qcshcz/evart/regplay/

#### 3 通知服务器游戏结束接口（仅能调用一次）

请求 ：http://www.gzfesco.cn/api/qcshcz/evart/zero/?pid=3&finish=1

| 参数   | 取值范围 | 说明                                        |
| ------ | -------- | ------------------------------------------- |
| pid    | 3        | 项目id                                      |
| finish | 0,1      | 0代表未完成，1代表已完成项目体验            |
| code   |          | 为40008,40009的时候，通过异常通知接口告诉我 |

正常返回示例：

{"code":20003,"message":"game state now set to 0"}

失败返回示例：

{"code":40000,"message":"\u901a\u8baf\u6210\u529f"}

表示通讯正常，但存有异常状况



## 2 车家互动（沙盘）

#### 1 用户扫码注册玩耍接口：

#### http://www.gzfesco.cn/api/qcshcz/carhome/regplay/

#### 2 车家互动答题记录

请求 ：http://www.gzfesco.cn/api/qcshcz/carhome/answerrecord/?elapsedtime=21&eid=12&finished=1&points=2

| 参数        | 取值范围 | 说明                                                     |
| ----------- | -------- | -------------------------------------------------------- |
| elapsedtime | int      | 用户本次答题所需时间（秒）如120代表用户答题的时间为2分钟 |
| eid         |          | 用户的id                                                 |
| finished    | 0-1      | 用户是否答完题目，1为答对完所有题目                      |
| points      | 0-4      | 用户答对多少题，如传3则答对3题                           |

正常返回示例：

{"code":20000,"message":"successful connected","data":[]}

| 参数 | 取值范围 | 说明                                   |
| ---- | -------- | -------------------------------------- |
| code | 20000    | 代表正常入库                           |
| code | 20007    | 代表原先的值比数据库的值还差，不能入库 |

失败返回示例：

{"code":40000,"message":"exception happend,please contact administrator","data":[]}

#### 3 车家互动答题排行榜

请求 ：http://www.gzfesco.cn/api/qcshcz/carhome/chart/?page=1&perpage=5

| 参数    | 取值范围 | 说明               |
| ------- | -------- | ------------------ |
| page    | int      | 第几页，默认第一页 |
| perpage | int      | 每一页多少条数据   |

正常返回示例：

{"code":20000,"message":"successful connected","data":[{"eid":12,"points":3,"elapsedtime":100,"mingci":1,"nickname":"nickname","headimgurl":"http:\/\/thirdwx.qlogo.cn\/mmopen\/vi_32\/Q0j4TwGTfTJhhm0bvVPbT7VmZiaVOIEdrhrz8fMe8Ipo4L88eAicibibqIFCQuf8RrmU6Fzo7t6YDVaaOicx80kQnmQ\/132","openid":"xxx"},{"eid":1,"points":3,"elapsedtime":100,"mingci":1,"nickname":"","headimgurl":"","openid":"222"},{"eid":55,"points":2,"elapsedtime":200,"mingci":3,"nickname":"Khun-Terminator","headimgurl":"http:\/\/thirdwx.qlogo.cn\/mmopen\/vi_32\/ic8EReGBh4PIlr8J1tFuKB1gtNZhA7hcoVC4vOJu7KxF6U9LVzCbaiarGHicPibhmgrxmQSKNqoicwhVQMPakKvsiclA\/132","openid":"oZPt5t4mnxkIsbvJ5Pip_yjLh_OQ"}]}{"code":20000,"message":"successful connected","data":[{"eid":12,"points":3,"elapsedtime":100,"mingci":1,"nickname":"nickname","headimgurl":"http:\/\/thirdwx.qlogo.cn\/mmopen\/vi_32\/Q0j4TwGTfTJhhm0bvVPbT7VmZiaVOIEdrhrz8fMe8Ipo4L88eAicibibqIFCQuf8RrmU6Fzo7t6YDVaaOicx80kQnmQ\/132"},{"eid":1,"points":3,"elapsedtime":100,"mingci":1,"nickname":"","headimgurl":""},{"eid":55,"points":2,"elapsedtime":200,"mingci":3,"nickname":"Khun-Terminator","headimgurl":"http:\/\/thirdwx.qlogo.cn\/mmopen\/vi_32\/ic8EReGBh4PIlr8J1tFuKB1gtNZhA7hcoVC4vOJu7KxF6U9LVzCbaiarGHicPibhmgrxmQSKNqoicwhVQMPakKvsiclA\/132"}]}{"code":20000,"message":"successful connected","data":[{"eid":55,"openid":"oZPt5t4mnxkIsbvJ5Pip_yjLh_OQ","nickname":"Khun-Terminator","headimgurl":"http:\/\/thirdwx.qlogo.cn\/mmopen\/vi_32\/ic8EReGBh4PIlr8J1tFuKB1gtNZhA7hcoVC4vOJu7KxF6U9LVzCbaiarGHicPibhmgrxmQSKNqoicwhVQMPakKvsiclA\/132"},{"eid":12,"openid":"xxx","nickname":"nickname","headimgurl":"http:\/\/thirdwx.qlogo.cn\/mmopen\/vi_32\/Q0j4TwGTfTJhhm0bvVPbT7VmZiaVOIEdrhrz8fMe8Ipo4L88eAicibibqIFCQuf8RrmU6Fzo7t6YDVaaOicx80kQnmQ\/132"},{"eid":1,"openid":"222","nickname":"","headimgurl":""},{"eid":4,"openid":"","nickname":"","headimgurl":""}]}

| 参数        | 取值范围 | 说明                                          |
| ----------- | -------- | --------------------------------------------- |
| eid         |          | 用户的id                                      |
| openid      |          | 用户的微信openid                              |
| nickname    |          | 用户的微信昵称                                |
| headimgurl  |          | 用户的微信头像                                |
| mingci      |          | 第几名，仅适用于首页。仅用于排第一名---第五名 |
| points      |          | 答对多少题                                    |
| elapsedtime |          | 耗时，秒                                      |

失败返回示例：

{"code":40000,"message":"exception happend,please contact administrator","data":[]}

#### 4 车家互动华容道

请求 ：http://www.gzfesco.cn/api/qcshcz/carhome/huarongdao/?eid=1&addtion=1&addtionelapsed=200

| 参数           | 取值范围 | 说明                          |
| -------------- | -------- | ----------------------------- |
| addtion        | int      | 用户是否完成华容道，1为已完成 |
| eid            |          | 用户的id                      |
| addtionelapsed | 整形，秒 | 完成华容道所需的时间          |

正常返回示例：

{"code":20000,"message":"successful connected","data":[]}

| 参数 | 取值范围 | 说明                                   |
| ---- | -------- | -------------------------------------- |
| code | 20000    | 代表正常入库                           |
| code | 20007    | 代表原先的值比数据库的值还差，不能入库 |
| code | 20008    | 用户没有玩过答题，不能更新库           |

失败返回示例：

{"code":40000,"message":"exception happend,please contact administrator","data":[]}

#### 5 车家互动华容道排行榜

请求 ：http://www.gzfesco.cn/api/qcshcz/carhome/huarongdao_chart/?page=1&perpage=5

| 参数    | 取值范围 | 说明               |
| ------- | -------- | ------------------ |
| page    | int      | 第几页，默认第一页 |
| perpage | int      | 每一页多少条数据   |

正常返回示例：

{"code":20000,"message":"successful connected","data":[{"eid":12,"addtionelapsed":100,"mingci":1,"nickname":"nickname","headimgurl":"http:\/\/thirdwx.qlogo.cn\/mmopen\/vi_32\/Q0j4TwGTfTJhhm0bvVPbT7VmZiaVOIEdrhrz8fMe8Ipo4L88eAicibibqIFCQuf8RrmU6Fzo7t6YDVaaOicx80kQnmQ\/132","openid":"xxx"},{"eid":1,"addtionelapsed":100,"mingci":1,"nickname":"","headimgurl":"","openid":"222"},{"eid":55,"addtionelapsed":200,"mingci":3,"nickname":"Khun-Terminator","headimgurl":"http:\/\/thirdwx.qlogo.cn\/mmopen\/vi_32\/ic8EReGBh4PIlr8J1tFuKB1gtNZhA7hcoVC4vOJu7KxF6U9LVzCbaiarGHicPibhmgrxmQSKNqoicwhVQMPakKvsiclA\/132","openid":"oZPt5t4mnxkIsbvJ5Pip_yjLh_OQ"}]}

| 参数           | 取值范围 | 说明                                          |
| -------------- | -------- | --------------------------------------------- |
| eid            |          | 用户的id                                      |
| openid         |          | 用户的微信openid                              |
| nickname       |          | 用户的微信昵称                                |
| headimgurl     |          | 用户的微信头像                                |
| addtionelapsed |          | 耗时（秒）                                    |
| mingci         |          | 第几名，仅适用于首页。仅用于排第一名---第五名 |

失败返回示例：

{"code":40000,"message":"exception happend,please contact administrator","data":[]}

#### 6 通知服务器游戏结束接口（仅能调用一次）

请求 ：http://www.gzfesco.cn/api/qcshcz/carhome/zero/?pid=2&finish=1

| 参数   | 取值范围 | 说明                                        |
| ------ | -------- | ------------------------------------------- |
| pid    | 2        | 项目id                                      |
| finish | 0,1      | 0代表未完成，1代表已完成项目体验            |
| code   |          | 为40008,40009的时候，通过异常通知接口告诉我 |

正常返回示例：

{"code":20003,"message":"game state now set to 0"}

失败返回示例：

{"code":40000,"message":"\u901a\u8baf\u6210\u529f"}

表示通讯正常，但存有异常状况



## 3 大屏篮球互动



#### 1 游戏正式开始接口 

请求 ： http://www.gzfesco.cn/api/qcshcz/ballgame/startwhatever/

正常返回示例：

{"code":20000,"message":"\u901a\u8baf\u6210\u529f"}

异常返回示例：

{"code":40000,"message":"\u901a\u8baf\u6210\u529f"}

#### 2 通知服务器报名结束接口 （设定游戏状态为报名结束状态）

请求 ： http://www.gzfesco.cn/api/qcshcz/ballgame/stopenlist/

{"code":20000,"message":"successful connected","data":[{"eid":39,"nickname":"\u963f\u6b66"},{"eid":12,"nickname":""},{"eid":41,"nickname":""}]}

正常返回示例：

| 参数       | 说明       |
| ---------- | ---------- |
| eid        | 用户id、   |
| nickname   | 用户拟称   |
| openid     | 微信openid |
| headimgurl | 微信头像   |

失败返回示例：

{"code":40000,"message":"\u901a\u8baf\u6210\u529f"}



#### 3 （测试报名接口）

http://www.gzfesco.cn/api/qcshcz/ballgame/regplay/



#### 4 单片机向服务器传送速度接口 

请求 ： http://www.gzfesco.cn/api/qcshcz/ballgame/speed_1/?speed=11

http://www.gzfesco.cn/api/qcshcz/ballgame/speed_2/?speed=222

http://www.gzfesco.cn/api/qcshcz/ballgame/speed_3/?speed=444

请求示例：

| 参数          | 说明              |
| ------------- | ----------------- |
| speed_1,_2_,3 | 分别代表3个单片机 |
| speed         | 整形，代表速度    |

返回示例：

| 参数    | 说明     |
| ------- | -------- |
| 字符串1 | 成功接受 |
| 字符串0 | 失败     |



#### 5 大屏向服务器轮询速度接口

请求 ： http://www.gzfesco.cn/api/qcshcz/ballgame/rollspeed/

{"code":20000,"message":"successful connected","data":[{"id":"4","eid":"12","playround":"2","chosen":"1","deviceid":"1","speed":"222"},{"id":"6","eid":"40","playround":"2","chosen":"1","deviceid":"3","speed":"0"},{"id":"7","eid":"41","playround":"2","chosen":"1","deviceid":"2","speed":"0"}]}

正常返回示例：

| 参数      | 说明                 |
| --------- | -------------------- |
| id        | 不用理会             |
| eid       | 用户id               |
| playround | 表示第几轮玩         |
| chosen    | 不用理会             |
| deviceid  | 表示第几个篮球单片机 |
| speed     | 速度值               |

失败返回示例：

{"code":40000,"message":"\u901a\u8baf\u6210\u529f"}



#### 6 大屏向服务器通知游戏正式开始接口

请求示例：http://www.gzfesco.cn/api/qcshcz/ballgame/tellmestart

正常返回：

{"code":20000,"message":"\u901a\u8baf\u6210\u529f"}

失败返回示例：

{"code":40000,"message":"\u901a\u8baf\u6210\u529f"}



#### 7 大屏向服务器通知结束接口

请求示例：： http://www.gzfesco.cn/api/qcshcz/ballgame/tellmestop/?action=1&first=eid&second=eid&third=eid

 http://www.gzfesco.cn/api/qcshcz/ballgame/tellmestop/?action=0

| 参数   | 取值范围                | 说明                                                         |
| ------ | ----------------------- | ------------------------------------------------------------ |
| action | 0-1，必传               | 0表示游戏重启，服务器不会记录中奖者的名次等信息；1表示正常重启；游戏会返回中奖者的名次，分数，用户id等信息 |
| first  | 用户eid，必传           | 仅在action为1的情况下，才会有冠亚军，最少有一个冠军，亚军和季军可留空 |
| second | 用户eid的，必传，可为空 | 仅在action为1的情况下，才会有冠亚军，最少有一个冠军，亚军和季军可留空 |
| third  | 用户eid的，必传，可为空 | 仅在action为1的情况下，才会有冠亚军，最少有一个冠军，亚军和季军可留空 |

正常返回示例：

{"code":20000,"message":"successful connected","data":[{"id":"4","eid":"12","playround":"2","chosen":"1","deviceid":"1","speed":"222","prize":"1"},{"id":"6","eid":"40","playround":"2","chosen":"1","deviceid":"3","speed":"0","prize":"2"},{"id":"7","eid":"41","playround":"2","chosen":"1","deviceid":"2","speed":"0","prize":"3"}]}

| 参数       | 取值范围 | 说明                                                      |
| ---------- | -------- | --------------------------------------------------------- |
| eid        | 用户的id | 用户的id                                                  |
| playround  | 数字     | 表示在第几轮玩                                            |
| chosen     | 不用理会 | 不用理会                                                  |
| id         | 不用理会 | 不用理会                                                  |
| deviceid   | 1-3      | 返回那个篮球单片机的id                                    |
| speed      | 整形     | 返回这个玩家的分数                                        |
| prize      | 1-3      | 返回这个玩家的冠亚军等（名次），1为冠军，2为亚军，3为季军 |
| openid     | openid   | 用户的openid                                              |
| nickname   | nickname | 用户的昵称                                                |
| headimgurl |          | 用户的微信头像                                            |

失败返回示例：

{"code":40000,"message":"\u901a\u8baf\u6210\u529f"}



#### 8 大屏向服务器轮询报名名单接口

请求 ： http://www.gzfesco.cn/api/qcshcz/ballgame/getlist

{"code":20000,"message":"successful connected","data":[{"id":"9","eid":"12","playround":"4","chosen":"0","deviceid":"0","speed":"0","prize":"0","openid":"xxx","headimgurl":"http:\/\/thirdwx.qlogo.cn\/mmopen\/vi_32\/Q0j4TwGTfTJhhm0bvVPbT7VmZiaVOIEdrhrz8fMe8Ipo4L88eAicibibqIFCQuf8RrmU6Fzo7t6YDVaaOicx80kQnmQ\/132","nickname":"nickname"}]}

正常返回示例：

| 参数       | 取值范围 | 说明                                                      |
| ---------- | -------- | --------------------------------------------------------- |
| eid        | 用户的id | 用户的id                                                  |
| playround  | 数字     | 表示在第几轮玩                                            |
| chosen     | 不用理会 | 不用理会                                                  |
| id         | 不用理会 | 不用理会                                                  |
| deviceid   | 1-3      | 返回那个篮球单片机的id                                    |
| speed      | 整形     | 返回这个玩家的分数                                        |
| prize      | 1-3      | 返回这个玩家的冠亚军等（名次），1为冠军，2为亚军，3为季军 |
| openid     | openid   | 用户的openid                                              |
| nickname   | nickname | 用户的昵称                                                |
| headimgurl |          | 用户的微信头像                                            |

失败返回示例：

{"code":40000,"message":"\u901a\u8baf\u6210\u529f"}



#### 9 抽奖报名接口（在对应页面摇晃手机时调用）

![img](file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml\wps796E.tmp.png)

请求 ：<http://www.gzfesco.cn/api/qcshcz/qcshczh5/shake/?openid=xxx>

| **参数** | **取值范围** | **说明**                                   |
| -------- | ------------ | ------------------------------------------ |
| openid   | 必填         | 对应着用户的openid ，xxx为测试的用户openid |

正常返回示例：{"code":20000,"message":"xxxx"}

| **参数** | **取值范围** | **说明** |
| -------- | ------------ | -------- |
| code     | 20000        | 正常入库 |

失败返回示例：

| **参数** | **说明**                                    |
| -------- | ------------------------------------------- |
| code     | 40000，代表请求到达服务器，但有异常情况发生 |
| code     | 40006, 游戏状态不对，不准入库               |



#### 10 正常测试流程

|                                                              | 大屏互动程序                    | 篮球单片机       | 云服务器接口 |
| ------------------------------------------------------------ | ------------------------------- | ---------------- | ------------ |
| 1.互动程序调用游戏开始接口                                   |                                 |                  | 接口1        |
| 2.手机微信扫描测试报名二维码                                 |                                 |                  | 接口3        |
| 3.互动程序开始轮询是否有人报名（循环调用查询接口）           | 在大屏内返回openid等，详见接口8 |                  | 接口8        |
| 4.互动程序停止轮询获取报名人员名单接口，调用报名结束接口（仅能调用该接口一次，调用第2次时候会返回40000错误） | 在大屏内返回中奖者名单信息      |                  | 接口2        |
| 5. 互动程序通知服务器游戏正式开始                            |                                 |                  | 接口6        |
| 6. 单片机开始向服务器发送拍球速度                            |                                 | 不断地发送速度值 | 接口4        |
| 7. 互动程序向服务器轮询拍球速度                              |                                 |                  | 接口5        |
| 停止拍球，并且通知服务器游戏结束，同时提交游戏结果（openid，排名） |                                 |                  | 接口7        |







## 3 图片上传接口

#### 